import { Head, Image, Appear } from 'mdx-deck';
import { CodeSurfer } from 'mdx-deck-code-surfer';
export { default as theme } from './theme';

<Head>
  <title>🧩 Front-end Testing 🧩 by Alessia Bellisario</title>
</Head>

# 🧩 Front-end Testing 🧩

### by Alessia Bellisario

---

# 🔺

#### ^ Proverbial pyramid

---

## Testing pyramid

<img
  width="500"
  src="https://blog.primehammer.com/wp-content/uploads/2017/02/image02-300x259.png"
/>

```notes
Why the pyramid metaphor?
- Mike Cohn, one of the inventors of Scrum, coined it
- He originally drew it in 2003-4 and described it at a scrum gathering in 2004
```

---

## Testing trophy

<img
  width="500"
  src="data:image/png;base64,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"
/>

```notes
Coined by Kent C. Dodds
see: https://twitter.com/kentcdodds/status/960723172591992832?lang=en
```

---

# Overview

1.  Review testing terms
2.  What is Enzyme?
3.  Testing implementation details
4.  React Testing Library vs. Enzyme

---

## 1. Testing terminology

- **Test runner**: runs tests, e.g. Wallaby, Karma, Jest in jest-runner
- **Testing framework**: organizes tests (in Jest, think: `describe` = suite, `it` = spec), e.g. Jest, AVA, Jasmine, Mocha, etc.
- **Mocking framework**: Jest, Sinon.js
- **Assertion library**: verify code's behaviour, e.g. Jest, AVA, Chai, ShouldJS

---

...what about Enzyme?

---

## 2. What's Enzyme?

> "Enzyme is a JavaScript _Testing utility_ for React that makes it easier to assert, manipulate, and traverse your React Components' output."
>
> https://airbnb.io/enzyme/

---

### Enzyme

The API revolves around manipulating ReactComponents via the ReactWrapper returned from find() or the React component itself using instance() rather than DOM nodes (what the end user would be interacting with)

---

<CodeSurfer
  title="Enzyme"
  code={require('!raw-loader!./snippets/enzyme.jsx')}
  steps={[
    { notes: 'use ⬆️ and ⬇️ keys' },
    { range: [7, 10], notes: 'shallow render' },
    { range: [11, 16], notes: 'test props' },
  ]}
/>

```notes
see: setProps utility fn provided by Enzyme

@TODO: define shallow vs mount?
```

---

## 3. "Testing implementation details"

---

<CodeSurfer
  title="Enzyme: calling react component methods"
  code={require('!raw-loader!./snippets/implementationDetails.jsx')}
/>

---

## Testing implementation details

1.  will this test break when there’s a mistake that would break the component in production?
2.  will this test continue to work when there’s a fully backward compatible refactor of the component?

---

<CodeSurfer
  title="Enzyme: calling react component methods"
  code={require('!raw-loader!./snippets/implementationDetailsWComments.jsx')}
  steps={[
    { notes: 'use ⬆️ and ⬇️ keys' },
    { lines: [1, 2, 3, 4, 5, 16], notes: '❌' },
    { lines: [7, 8, 9, 10, 11, 16], notes: '❌' },
  ]}
/>

---

## 4. Enzyme vs. RTL

---

| Enzyme                                           | React Testing Library                                                 |
| ------------------------------------------------ | --------------------------------------------------------------------- |
| ✅ query elements by class name                  | ❌                                                                    |
| ✅ shallow rendering                             | ❌                                                                    |
| ✅ get a component `instance`                    | ❌                                                                    |
| ✅ get and set a component's `props()`/`state()` | ❌                                                                    |
| ❌                                               | ✅ test real DOM elements                                             |
| ❌                                               | ✅ full support for React's Context API                               |
| ❌                                               | ✅ utils for async DOM manipulations                                  |
| ❌                                               | ✅ interact with DOM nodes produced by functional components          |
| ❌                                               | ✅ encourages accessibility: query elements with accessible selectors |

---

Even with `mount` in Enzyme, the API revolves around manipulating ReactComponents via the ReactWrapper returned from find() or the React component itself using instance() rather than DOM nodes (what the end user would be interacting with).
souce: https://medium.com/homeaway-tech-blog/integration-testing-in-react-21f92a55a894

---

What about accessing DOM nodes via Enzyme?

---

## `.getDOMNode() => DOMComponent`

Returns the outer most DOMComponent of the current wrapper.

- can only be called on a wrapper of a single node.
- will raise if called on a wrapper of a stateless functional component.

#### Returns

`DOMComponent`: The retrieved DOM component.

```jsx
const wrapper = mount(<MyComponent />);
expect(wrapper.getDOMNode()).to.have.property('className');
```

Soure: [Enzyme docs](https://github.com/airbnb/enzyme/blob/master/docs/api/ReactWrapper/getDOMNode.md)

---

# Final thought: RTL encourages accessibility

- Tests will fail if e.g. form not wired up to input correctly
- RTL provides documentation: ["Which query should I use?"](https://testing-library.com/docs/guide-which-query)
- #1 is **Queries Accessible to Everyone**: queries that reflect the experience of visual/mouse users as well as those that use assistive technology

---

# Summary

- RTL allows us to test real DOM elements, not `ReactWrapper`s or React components, to more accurately test the experience of the end user
- For this reason it pushes us away from testing implementation details which can give us false positives (tests that fail when we change the implementation) or false negatives (e.g. unit testing component props but a typo breaks the component)
- It also encourages accessibility by providing queries that reflect the experience of visual/mouse users as well as those using assistive technology

---

# Summary cont'd

- Better developer experience: handling async behaviour is easier and debugging is a breeze compared to Enzyme
- Hooks: Enzyme doesn't play nicely with functional components, so RTL is more future-proof
- Styled Components v4: we're currently prevented from upgrading because of a compatibility issue with Enzyme

---

🔼 Thanks 🔼
